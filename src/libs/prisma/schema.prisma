generator client {
  provider = "prisma-client-js"
}

generator nestgraphql {
  provider                              = "prisma-nestjs-graphql"
  output                                = "./generated"
  outputFilePattern                     = "{model}/{name}/{type}.ts"
  noAtomicOperations                    = true
  purgeOutput                           = true
  noTypeId                              = true
  requireSingleFieldsInWhereUniqueInput = ture
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

enum Character {
  TREE
  FOX
  GOKU
  CAT
  PUDDING
  REAPER
}

enum Game {
  NONE
  XENO
  COIN_DROPPING
  ICE_RAZE
  PRESIDENT
  POKER
  WE_DIDNT_PLAYTEST
}

type CaharacterItem {
  obtained Boolean @default(false)
  itemUrl  String  @map("item_url")
}

model User {
  id    String @id @map("_id") @db.ObjectId
  name  String
  email String
  role  Role

  totalPointDay1  Int @default(0) @map("total_point_day1")
  totalPointDay2  Int @default(0) @map("total_point_day2")
  consumablePoint Int @default(0) @map("consumption_point")

  character Character
  iconUrl   String           @map("icon_url")
  avatarUrl String           @map("avatar_url")
  items     CaharacterItem[]

  participateGame Game @map("participate_game")

  pullableGachaTimes Int @default(0) @map("pullable_gacha_times")

  giftHistories GiftHistory[]

  createdAt DateTime @default(now()) @map("created_at")

  @@map("users")
}

model Item {
  id  String @id @default(auto()) @map("_id") @db.ObjectId
  url String

  character Character
  layer     Int

  @@map("items")
}

enum GiftName {
  BABY_STAR
  MOROKOSHI
  CABAGGE
  UMAIBO_CHEESE
  UMAIBO_CORN_POTAGE
  UMAIBO_MENTAIKO
}

model Gift {
  id      String   @id @default(auto()) @map("_id") @db.ObjectId
  name    GiftName
  iconUrl String   @map("icon_url")

  price     Int
  remaining Int @default(30)

  giftHistories GiftHistory[]

  createdAt DateTime @default(now()) @map("created_at")

  @@map("gifts")
}

model GiftHistory {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  isDelivered Boolean @default(false)

  user   User   @relation(fields: [userId], references: [id])
  userId String @map("user_id")

  exchangedGift Gift   @relation(fields: [giftId], references: [id])
  giftId        String @map("gift_id") @db.ObjectId

  createdAt DateTime @default(now()) @map("created_at")

  @@map("gift_histories")
}
